# Skynet
[MITRE ATT&CK Enterprise tactics](https://attack.mitre.org/tactics/enterprise/)
## Reconnaissance (ID: TA0043)
### Active Scanning: Vulnerability Scanning (T1595.002)
```
nmap -Pn -O  -p- -sV --script vuln -oN TARGET_IP.nmap TARGET_IP
```
  * `-Pn` scan without pinging.
  * `-O` attempts to discover which OS is running.
  * `-p-` scan all ports.
  * `-sV` gather details about services and applications running on identified open ports.
  * `--script vuln` runs vulnerability detection scripts.
  * `-oN` output resuits in default/normal format.
```
Starting Nmap 7.60 ( https://nmap.org ) at 2024-03-01 08:37 GMT
Warning: 10.10.9.168 giving up on port because retransmission cap hit (2).
Nmap scan report for ip-10-10-9-168.eu-west-1.compute.internal (10.10.9.168)
Host is up (0.00046s latency).
Not shown: 65529 closed ports
PORT    STATE SERVICE     VERSION
22/tcp  open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
80/tcp  open  http        Apache httpd 2.4.18 ((Ubuntu))
| http-csrf: 
| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=ip-10-10-9-168.eu-west-1.compute.internal
|   Found the following possible CSRF vulnerabilities: 
|     
|     Path: http://ip-10-10-9-168.eu-west-1.compute.internal:80/
|     Form id: 
|     Form action: #
|     
|     Path: http://ip-10-10-9-168.eu-west-1.compute.internal/#
|     Form id: 
|_    Form action: #
|_http-dombased-xss: Couldn't find any DOM based XSS.
| http-enum: 
|   /squirrelmail/src/login.php: squirrelmail version 1.4.23 [svn]
|_  /squirrelmail/images/sm_logo.png: SquirrelMail
|_http-server-header: Apache/2.4.18 (Ubuntu)
| http-slowloris-check: 
|   VULNERABLE:
|   Slowloris DOS attack
|     State: LIKELY VULNERABLE
|     IDs:  CVE:CVE-2007-6750
|       Slowloris tries to keep many connections to the target web server open and hold
|       them open as long as possible.  It accomplishes this by opening connections to
|       the target web server and sending a partial request. By doing so, it starves
|       the http server's resources causing Denial Of Service.
|       
|     Disclosure date: 2009-09-17
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750
|_      http://ha.ckers.org/slowloris/
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
110/tcp open  pop3        Dovecot pop3d
|_sslv2-drown: 
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
143/tcp open  imap        Dovecot imapd
|_sslv2-drown: 
445/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
MAC Address: 02:FC:A9:D7:37:E3 (Unknown)
Device type: general purpose|WAP|phone|media device
Running (JUST GUESSING): Linux 3.X|4.X (99%), Asus embedded (94%), Google Android 5.X|6.X|7.X (92%)
OS CPE: cpe:/o:linux:linux_kernel:3.13 cpe:/h:asus:rt-n56u cpe:/o:linux:linux_kernel:3.4 cpe:/o:google:android:5 cpe:/o:google:android:6 cpe:/o:linux:linux_kernel:3.18 cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:3.x
Aggressive OS guesses: Linux 3.13 (99%), ASUS RT-N56U WAP (Linux 3.4) (94%), Linux 3.16 (94%), Linux 3.1 (93%), Linux 3.2 (93%), Linux 3.8 (92%), Android 5.0 - 5.1 (92%), Android 5.1 (92%), Android 6.0-7.1.2 (Linux 3.18-4.4.1) (92%), Linux 3.12 (92%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 1 hop
Service Info: Host: SKYNET; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_smb-vuln-ms10-054: false
|_smb-vuln-ms10-061: false
| smb-vuln-regsvc-dos: 
|   VULNERABLE:
|   Service regsvc in Microsoft Windows systems vulnerable to denial of service
|     State: VULNERABLE
|       The service regsvc in Microsoft Windows 2000 systems is vulnerable to denial of service caused by a null deference
|       pointer. This script will crash the service if it is vulnerable. This vulnerability was discovered by Ron Bowes
|       while working on smb-enum-sessions.
|_          

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 512.51 seconds
```
**SSH**
* OpenSSH 7.2p2 is vulnerable to exploitable  [CVE-2016-6210](https://nvd.nist.gov/vuln/detail/CVE-2016-6210).
> sshd in OpenSSH before 7.3, when SHA256 or SHA512 are used for user password hashing, uses BLOWFISH hashing on a static password when the username does not exist, which allows remote attackers to enumerate users by leveraging the timing difference between responses when a large password is provided.
* [OpenSSH 7.2p2 - Username Enumeration](https://www.exploit-db.com/exploits/40136)
* [OpenSSHd 7.2p2 - Username Enumeration](https://www.exploit-db.com/exploits/40113).
**HTTP**
* Squirrelmail 1.4.23 is potentially vulnerable to a number of exploitable vulnerabilities.
  * [CVE-2006-4019](https://nvd.nist.gov/vuln/detail/CVE-2006-4019).
    * [SquirrelMail < 1.4.7 - Arbitrary Variable Overwrite](https://www.exploit-db.com/exploits/43839).
  * [CVE-2005-2095](https://nvd.nist.gov/vuln/detail/CVE-2005-2095).
    * [SquirrelMail < 1.4.5-RC1 - Arbitrary Variable Overwrite](https://www.exploit-db.com/exploits/43830).
  * [CVE-2017-7692](https://nvd.nist.gov/vuln/detail/CVE-2017-7692).
    * [SquirrelMail < 1.4.22 - Remote Code Execution ](https://www.exploit-db.com/exploits/41910).
  * [CVE-2006-2842](https://nvd.nist.gov/vuln/detail/CVE-2006-2842).
    * [Squirrelmail 1.4.x - 'Redirect.php' Local File Inclusion](https://www.exploit-db.com/exploits/27948).
  * [CVE-2005-3128](https://nvd.nist.gov/vuln/detail/CVE-2005-3128).
    * [SquirrelMail 1.4.2 Address Add Plugin - 'add.php' Cross-Site Scripting ](https://www.exploit-db.com/exploits/26305).
  * [CVE-2004-0519](https://nvd.nist.gov/vuln/detail/CVE-2004-0519).
    * [SquirrelMail 1.4.x - Folder Name Cross-Site Scripting](https://www.exploit-db.com/exploits/24068).
* Nmap vuln script identified possible CSRF vulnerabilities.
```
Path: http://ip-10-10-9-168.eu-west-1.compute.internal:80/
Form id: 
Form action: #

Path: http://ip-10-10-9-168.eu-west-1.compute.internal/#
Form id: 
Form action: #
```
* Apache 2.4.18 is vulnerable to a number of expolitable vulnerabilities.
  * [CVE-2021-44790](https://nvd.nist.gov/vuln/detail/CVE-2021-44790).
    * [Apache 2.4.x - Buffer Overflow](https://www.exploit-db.com/exploits/51193).
  * [CVE-2019-0211](https://nvd.nist.gov/vuln/detail/CVE-2019-0211).
    * [Apache 2.4.17 < 2.4.38 - 'apache2ctl graceful' 'logrotate' Local Privilege Escalation](https://www.exploit-db.com/exploits/46676).
* Use GoBuster to search for hidden directories.
```
gobuster dir --url http://TARGET_IP/ -w /usr/share/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-big.txt > gobuster.txt
```
```
[snip...]
/admin (Status: 301)
/css (Status: 301)
/js (Status: 301)
/config (Status: 301)
/ai (Status: 301)
/squirrelmail (Status: 301)
/server-status (Status: 403)
[snip...]
```
* Browse to http://TARGET_IP.
![image](https://github.com/clydebuilt1974/TryHackMe/assets/157394432/064deb75-0b00-4063-a3a9-235970473303)
* Browse to http://TARGET_IP/squirrelmail.
![image](https://github.com/clydebuilt1974/TryHackMe/assets/157394432/c99554e8-0f5d-4810-a457-22e8d10aae98)
* Browsing to all directories identified by Gobuster results in "Forbidden" message.
![image](https://github.com/clydebuilt1974/TryHackMe/assets/157394432/aeb3f5c4-4516-44f2-b0fc-4c75a3a69c17)

**POP3**
* Dovecot pop3d.
**SMB**
* netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
**IMAP**
* Dovecot pop3d.

## Initial Access (ID: TA0001)
* Failed to logon to Dovecot POP3.
```
telnet 10.10.9.168 110
Trying 10.10.9.168...
Connected to 10.10.9.168.
Escape character is '^]'.
+OK Dovecot ready.
user miles
-ERR [AUTH] Plaintext authentication disallowed on non-secure (SSL/TLS) connections.
```
* Failed to logon to Dovecot IMAP.
```
telnet 10.10.9.168 143
Trying 10.10.9.168...
Connected to 10.10.9.168.
Escape character is '^]'.
* OK [CAPABILITY IMAP4rev1 LITERAL+ SASL-IR LOGIN-REFERRALS ID ENABLE IDLE LOGINDISABLED] Dovecot ready.
c1 LOGIN Miles
c1 BAD Error in IMAP command received by server.
```
## Privilege Escalation (ID: TA0004)

