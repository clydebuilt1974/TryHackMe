# Internal
## Pre-engagement Briefing
* Client wants penetration test on environment due to be relased to production in 3 weeks.
### Scope of Work
* Conduct external. web app, and internal assessment of provided virtual environment.
* Minimal information provided about assessment - black box test.
* Secure user.txt and root.txt flags as proof of exploitation.
### Scope Allowances
* Ensure tester's hosts file is modified to reflect internal.thm.
* Any tools or techniques are permitted.
* Locate and note all vulnerabilities found.
* Submit found flags to dashboard.
* Only IP address of tester's host is in scope.

## [Amend Hosts file](https://docs.rackspace.com/docs/modify-your-hosts-file)
* `sudo nano /etc/hosts`.
* Add entry for TARGET_IP to resolve to internal.thm.
* CTRL+X 

## Perform Nmap vulnerability scan (Active Scanning: Vulnerability Scanning (T1595.002))
```
nmap -Pn -p- -sV --script=vuln -oN TARGET_IP_scan.nmap TARGET_IP

Nmap scan report for ip-10-10-9-105.eu-west-1.compute.internal (10.10.9.105)
Host is up (0.00053s latency).
Not shown: 65533 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-csrf: Couldn't find any CSRF vulnerabilities.
|_http-dombased-xss: Couldn't find any DOM based XSS.
| http-enum: 
|   /blog/: Blog
|   /phpmyadmin/: phpMyAdmin
|   /wordpress/wp-login.php: Wordpress login page.
|_  /blog/wp-login.php: Wordpress login page.
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
MAC Address: 02:A1:1A:FB:45:B9 (Unknown)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 215.22 seconds
```
## TCP/22
* Attempted to connect anonymously.
```
ssh anonymous@10.10.9.105
anonymous@10.10.9.105's password: 
Permission denied, please try again.
```

## TCP/80
### Perform GoBuster hidden directory scan (Active Scanning: Wordlist Scanning (T1595.003))
```
gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u TARGET_IP > gobuster80.txt

[...snip...]
/blog (Status: 301)
/wordpress (Status: 301)
/javascript (Status: 301)
/phpmyadmin (Status: 301)
/server-status (Status: 403)
[...snip...]
```
### Browse to website
* Displays Apache2 Ubuntu default page - Misconfiguration vulnerability.
### Browse directories discovered by GoBuster
* /blog
  * Search box displayed.
  * Viewing page source displays comment that framework is using "twentyseventeen" theme. 
```
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentyseventeen-ie8-css'  href='http://internal.thm/blog/wp-content/themes/twentyseventeen/assets/css/ie8.css?ver=20161202' media='all' />
<![endif]-->
<!--[if lt IE 9]>
<script src='http://internal.thm/blog/wp-content/themes/twentyseventeen/assets/js/html5.js?ver=20161020'></script>
<![endif]-->
```
* /wordpress
  * Displays "Oops! That page can't be found." message on WordPress page.
  * Search box displayed.
* /javascript
  * Displays forbidden page.
* /phpmyadmin
  * Displays "Welcome to phpMyAdmin" page with "Log in" form.
  * [Default phpMyAdmin credentials](https://stackoverflow.com/questions/5818358/phpmyadmin-default-login-password).
    * Tried username: root, password: null - "Login without a password is forbidden by configuration (see AllowNoPassword)".
    * Tried username: root, password root - "#1698 - Access denied for user 'root'@'localhost'".
    * Tried username: root, password password - "#1698 - Access denied for user 'root'@'localhost'".
* /server-status
  * Displays forbidden page.
### Perform [WPscan](https://www.kali.org/tools/wpscan/) scan (Active Scanning: Vulnerability Scanning (T1595.002))
```
wpscan --url http://internal.thm/wordpress --enumerate p

[...snip...]
Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.29 (Ubuntu)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://internal.thm/wordpress/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access

[+] WordPress readme found: http://internal.thm/wordpress/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://internal.thm/wordpress/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.4.2 identified (Insecure, released on 2020-06-10).
 | Found By: Rss Generator (Passive Detection)
 |  - http://internal.thm/blog/index.php/feed/, <generator>https://wordpress.org/?v=5.4.2</generator>
 |  - http://internal.thm/blog/index.php/comments/feed/, <generator>https://wordpress.org/?v=5.4.2</generator>

[+] WordPress theme in use: twentyseventeen
 | Location: http://internal.thm/wordpress/wp-content/themes/twentyseventeen/
 | Last Updated: 2024-01-16T00:00:00.000Z
 | Readme: http://internal.thm/wordpress/wp-content/themes/twentyseventeen/readme.txt
 | [!] The version is out of date, the latest version is 3.5
 | Style URL: http://internal.thm/blog/wp-content/themes/twentyseventeen/style.css?ver=20190507
[...snip...]
[+] Enumerating Users (via Passive and Aggressive Methods)
Brute Forcing Author IDs - Time: 00:00:00 <==> (10 / 10) 100.00% Time: 00:00:00

[i] User(s) Identified:

[+] admin
 | Found By: Rss Generator (Passive Detection)
 | Confirmed By:
 |  Wp Json Api (Aggressive Detection)
 |   - http://internal.thm/blog/index.php/wp-json/wp/v2/users/?per_page=100&page=1
 |  Login Error Messages (Aggressive Detection)
[...snip...]
```
### Identify WordPress administrative logon URL (Reconnaissance: Gather Victim Host Information: Software (T1592.002)
* Default location is "/wp-login.php".
  * This worked!
> **[How to Find Your WordPress Login Url](https://kinsta.com/blog/wordpress-login-url/):** If you installed WordPress on a subdirectory (www.yoursite.com/wordpress/) or subdomain (blog.yoursite.com/), add one of the three paths at the very end of your URL such as: www.yoursite.com/wordpress/wp-login.php or blog.yoursite.com/wp-login.php
### Password guess WordPress administrative logon URL
* [Default Wordpress credentials](https://varyingvagrantvagrants.org/docs/en-US/default-credentials/) are admin / password - "Error: The password you entered for the username admin is incorrect. Lost your password?".
* Attempt to Password guess using Hydra.
```
hydra -l admin -P /usr/share/wordlists/rockyou.txt TARGET_IP http-post-form "/wordpress/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log+In&redirect_to=http%3A%2F%2FTARGET_IP%2Fwordpress%2Fwp-admin%2F&testcookie=1:Error" -T 64 -vV
```
### Search for WordPress 5.4.2 exploits
* 
